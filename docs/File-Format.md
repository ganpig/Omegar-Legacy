# 谱面相关文件格式

## 歌曲文件夹及歌曲压缩包（zip 格式，文件扩展名为 `.omgz`，z 代表 zip）

- 歌曲信息文件：`info.omgs`
- 歌曲音频：`music.ogg`
- 曲绘：`illustration.png`
- 谱面文件： `charts/(等级名称).omgc`

## 歌曲信息文件（文本格式，文件扩展名为 `.omgs`，s 代表 song）

- 前 3 行：3 个字符串，分别表示曲名、曲师、画师。
- 第 4 行：一个整数 n，表示谱面数量。
- 第 5 行起：n 组谱面信息（每组谱面信息有 4 行，分别表示难度、定数、谱师、谱面文件 MD5 值）。

## 谱面文件（二进制格式，文件扩展名为 `.omgc`，c 代表 chart）

该文件由一个整数 n 和 n 个指令构成。

指令格式：时间（单位为 ms，-1 表示游戏开始前执行） + 类型 + 参数。

指令列表如下：

#### `0x01` 添加 note

- 参数 1：note 的 ID。
- 参数 2：note 的属性（note 具有的属性所对应的 2 的整数次幂按位或的结果）
- 参数 3：初始位置。
- 参数 4：初始轨道。
- 参数 5：判定轨道。
- 参数 6：判定时间。
- 参数 7：结束时间。

#### `0x02` 更改 note 位置（关于时间的二次函数系数）

- 参数 1：note 的 ID。
- 参数 2：二次项系数。
- 参数 3：一次项系数。
- 参数 4：常数项。

#### `0x03` 更改 note 轨道

- 参数 1：note 的 ID。
- 参数 2：目标轨道。
- 参数 3：目标时间。
- 参数 4：缓动类型。
  - `0x01` 直线缓动（动态更新 $p=(t_2-t)p_1+(t-t_1)p_2$)
  - `0x02` 正弦缓动（预处理 $A=\frac{t_1+t_2}{2},B=\frac{\pi}{t_1-t_2},C=\frac{p_1-p_2}{2},D=\frac{p_1+p_2}{2}$，动态更新 $p=Csin((t-A)B)+D$）

#### `0x04` 显示/隐藏 note

- 参数 1：note 的 ID。

#### `0x10` 更改判定线位置

- 参数 1：目标位置。
- 参数 2：目标时间。
- 参数 3：缓动类型。
